<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TAK</title>
    <link rel="stylesheet" href="tak.css">
</head>
<body>
<div class="wrapper">
    <div class="timer-label">
        <span >Timer</span>
    </div>
    <div class="logo-wrap">
        <p class="claw"></p>
        <p class="claw"></p>
        <p class="claw"></p>
        <p class="claw"></p>
    </div>
    <div class="ui-wrapper">
            <div class="user-input">
                <label for="hour-value">Hours:</label>
                <input type="number" id="hour-value" max="99" maxlength="2" placeholder="00h">

                <label for="min-value">Minutes:</label>
                <input type="number" id="min-value" max="60" maxlength="2" placeholder="00m">

                <label for="sec-value">Seconds:</label>
                <input type="number" id="sec-value" max="60" maxlength="2" placeholder="00s">
            </div>

            <div class="button-container">
                <button type="submit" id="submit-button" ><img src="start.png" alt="start"></button>
                <button type="reset" id="reset-button"><img src="restart.png" alt="restart"></button>
            </div>
    </div>
    <div id="timer-container" class="time-object"></div>
</div>
<script>
    const minValue = document.getElementById("min-value")
    const secValue = document.getElementById("sec-value")

    document.querySelectorAll('input[type="number"]').forEach((input)=>{
        input.oninput = () =>{
            if(input.value.length > input.maxLength) input.value = input.value.slice(0, input.maxLength)
        }
    } )
    minValue.oninput = ()=>{
        if(minValue.value.length > minValue.maxLength) minValue.value = 60
    }
    secValue.oninput = ()=>{
        if(secValue.value.length > secValue.maxLength) secValue.value = 60
    }
</script>
<script>

    const submit = document.getElementById("submit-button"),
        reset = document.getElementById("reset-button");
        instances = []
    submit.addEventListener('click', ()=>{
        timerCreateProcessing()
    })
    reset.addEventListener('click', ()=>{
        timerCreateProcessing(true)
    })

    class Timer{
        constructor(hourValue = 0, minutValue = 0, secValue = 0) {
            this.hours = hourValue;
            this.minutes = minutValue;
            this.seconds = secValue;
        }
        process(){
            this.timer()
            if(this.hours === 0 && this.minutes === 0  && this.seconds === 0){
                this.remove()
                return true;
            }
        }
        timer(){
            if(this.seconds >= 1){
                this.seconds--
                return;
            }
            if(this.minutes >= 1){
                this.minutes--
                this.seconds = 59
                return;
            }
            if(this.hours >= 1){
                this.hours--
                this.minutes = 60
                return;
            }
        }
        showTime(){
            return prefixNum(this.hours) + ":" + prefixNum(this.minutes) + ":" + prefixNum(this.seconds)
        }
        remove(){
            delete this
        }
    }
    const showTime = (container, timerContent, timer)=>{
        timerContent.textContent = timer.showTime()
    }
    const prefixNum = (numb)=>{
        return numb < 10 ? "0" + numb : numb
    }
    const removeElementsOfTimer =(element, interval)=>{
        element.remove()
        clearInterval(interval)
    }
    const timerCreateProcessing = (remove=0)=>{
        if(remove){
            instances.forEach((timer)=>{
                timer.remove()
            })
            setTimeout(()=>{document.getElementById("timer-container").innerHTML = ""}, 2000)
            return;
        }
        const hourValue = document.getElementById("hour-value").value,
            minutValue = document.getElementById("min-value").value,
            secValue = document.getElementById("sec-value").value,
            div = document.getElementById("timer-container");

        let divTimer = document.createElement("div")
        let timer = new Timer(Number(hourValue), Number(minutValue), Number(secValue))

        instances.push(timer)

        let interval = setInterval(()=> {

            showTime(div, divTimer, timer)
            if(timer.process()){setTimeout(()=>{removeElementsOfTimer(divTimer, interval)},5000)
            }
        }, 1000)
        div.insertAdjacentElement('beforeend', divTimer)
    }
</script>
</body>
</html>